# асинхронный сервер на много клиентов v2
## Разберем код
В первой версии у нас есть проблема, которую мы будем решать во второй версии: при отключении клиента от сервера в векторе ``clients`` он не удаляется.

### Обработка ошибки
```cpp
if (ec) {
    cout << "error - " <<ec.message()<< endl;
    thread t1(disconnection, this);
    t1.detach();
}
```
Если при чтении произошла ошибка, то выводится сообщение об ошибке, в новом потоке вызывается функция `disconnection` в которую передается указатель на класс в котором произошла ошибка.

### disconnection
```cpp
void disconnection(talk_to_client* client) {
    cout << "start find" << endl;
    auto it = find_if(clients.begin(), clients.end(),
        [client](const client_ptr& c) {return c.get() == client; });

    if (it != clients.end()) {
        clients.erase(it);
    }
    cout << "clients size - " << clients.size() << endl;
}
```
После вывода `start find `вызывается функция `find_if` для поиска переданного экземпляра клиента, поиск производится по всему вектору `(clients.begin(), clients.end())`, в предикате мы проверяем, равен ли переданный в функцию указатель указателю из вектора, если они равны, то функция возвращает этот указатель, который присваивается переменной `it`.
Потом мы проверяем, есть ли этот элемент в векторе `(it != clients.end())`. Если он есть, то удаляем его из вектора, используя функцию `erase`, и выводим сообщение о количестве оставшихся элементов в векторе.